---
description: 记录和查询医学辐射暴露记录
arguments:
  - name: action
    description: 操作类型：add(添加记录)/status(查看累积)/history(历史记录)/clear(清空记录)
    required: true
  - name: exam_type
    description: 检查类型（如：CT、X光、PET-CT等）
    required: false
  - name: body_part
    description: 检查部位（如：头部、胸部、腹部等）
    required: false
  - name: exam_date
    description: 检查日期（格式：YYYY-MM-DD，默认今天）
    required: false
---

# 医学辐射暴露管理

记录、追踪和查询医学影像检查的辐射暴露情况，帮助管理累积辐射剂量。

## 操作类型

### 1. 添加辐射记录 - `add`

记录一次医学影像检查的辐射暴露。

**参数说明：**
- `exam_type`: 检查类型（CT、X光、PET-CT、骨扫描、血管造影等）
- `body_part`: 检查部位（头部、胸部、腹部、盆腔、脊柱、四肢等）
- `exam_date`: 检查日期，格式 YYYY-MM-DD，默认为今天

**示例：**
```
/radiation add CT 胸部
/radiation add CT 腹部 2025-12-30
/radiation add X光 胸部
/radiation add PET-CT 全身
```

### 2. 查看累积状态 - `status`

查看当前的辐射累积情况和消散状态。

**示例：**
```
/radiation status
```

### 3. 查看历史记录 - `history`

查看所有辐射暴露记录。

**示例：**
```
/radiation history
/radiation history recent 10
```

### 4. 清空记录 - `clear`

清空所有辐射记录（谨慎使用）。

**示例：**
```
/radiation clear
```

## 执行步骤

### 添加记录 (add)

1. **检查基础参数**
   - 读取 `data/profile.json`
   - 如果不存在，提示："/profile set 命令设置身高体重"

2. **解析检查信息**
   - 识别检查类型（CT、X光、PET-CT等）
   - 识别检查部位（头部、胸部、腹部等）
   - 确定检查日期（默认今天）

3. **计算辐射剂量**
   - 从参考数据中获取标准剂量
   - 读取用户体表面积
   - 计算调整系数：实际BSA / 1.73
   - 计算实际剂量：标准剂量 × 调整系数

4. **保存记录**
   - 读取 `data/radiation-records.json`
   - 添加新记录到数组
   - 按日期倒序排列

5. **输出确认**
   ```
   ✅ 辐射记录已添加

   检查信息：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   检查项目：胸部 CT
   检查日期：2025-12-31
   辐射剂量：7.5 mSv

   本年度累积：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   本年剂量：15.3 mSv
   上年残留：3.2 mSv
   总有效剂量：18.5 mSv

   ⚠️ 注意：本年度累积剂量已超过建议安全范围（10 mSv）
   ```

### 查看累积状态 (status)

1. **读取所有记录**
   - 读取 `data/radiation-records.json`

2. **计算累积剂量**
   - 按年份分组统计
   - 计算往年剂量残留（指数衰减：50%/年）
   - 计算本年累积剂量
   - 计算总有效剂量

3. **输出状态报告**
   ```
   📊 辐射暴露累积报告

   当前概况：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   本年剂量：15.3 mSv
   往年残留：3.2 mSv
   总有效剂量：18.5 mSv

   年度统计：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   2025年：15.3 mSv (5次检查)
   2024年：6.4 mSv → 残留 3.2 mSv (衰减50%)
   2023年：2.1 mSv → 残留 0.5 mSv (衰减75%)

   安全评估：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   年平均自然本底：2.4 mSv/年
   公众年剂量限值：1 mSv/年（除自然本底外）
   当前状态：⚠️ 超过建议安全范围

   建议：
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   1. 与医生讨论是否可以采用低剂量或无辐射的替代检查
   2. 记录每次检查的辐射剂量
   3. 避免不必要的重复检查
   ```

### 查看历史记录 (history)

1. **读取记录**
   - 读取 `data/radiation-records.json`

2. **格式化输出**
   ```
   📋 辐射暴露历史记录

   2025年12月 (共3次检查，累积 12.5 mSv)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   12-31  胸部CT        7.5 mSv
   12-15  腹部CT        8.6 mSv
   12-01  胸部X光       0.12 mSv

   2024年11月 (共2次检查，累积 6.4 mSv)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   11-20  头部CT        2.1 mSv
   11-05  胸部CT        7.2 mSv

   总计：7次检查，累积 18.9 mSv
   ```

## 辐射剂量参考表

### CT检查 (标准剂量)
| 部位 | 剂量 (mSv) |
|------|-----------|
| 头部 | 2 |
| 胸部 | 7 |
| 腹部 | 8 |
| 盆腔 | 6 |
| 脊柱 | 6 |
| 四肢 | 0.1 |
| 全身 | 10 |

### X光检查 (标准剂量)
| 部位 | 剂量 (mSv) |
|------|-----------|
| 胸部 | 0.1 |
| 腹部 | 0.7 |
| 四肢 | 0.01 |
| 牙齿 | 0.005 |

### 其他检查
| 类型 | 剂量 (mSv) |
|------|-----------|
| PET-CT | 14 |
| 骨扫描 | 6 |
| 血管造影 | 5-15 |
| 乳腺钼靶 | 0.4 |

## 辐射衰减计算

采用指数衰减模型：

```
残留剂量 = 初始剂量 × (0.5)^(经过年数)
```

示例：
- 1年前：50%
- 2年前：25%
- 3年前：12.5%

## 数据结构

`data/radiation-records.json` 格式：

```json
{
  "created_at": "2025-12-31",
  "last_updated": "2025-12-31",
  "records": [
    {
      "id": "20251231123456789",
      "exam_type": "CT",
      "body_part": "胸部",
      "exam_date": "2025-12-31",
      "standard_dose": 7.0,
      "body_surface_area": 1.85,
      "adjustment_factor": 1.07,
      "actual_dose": 7.5,
      "dose_unit": "mSv"
    }
  ],
  "statistics": {
    "total_records": 7,
    "total_dose": 18.9,
    "current_year_dose": 15.3,
    "previous_years_residual": 3.2,
    "effective_dose": 18.5
  }
}
```

## 安全阈值

- ✅ **安全**: < 1 mSv/年
- ⚠️ **关注**: 1-10 mSv/年
- ⚠️ **警告**: 10-50 mSv/年
- 🚨 **危险**: > 50 mSv/年

## 注意事项

- 辐射剂量根据体表面积自动调整
- 往年辐射按50%/年衰减计算
- 所有记录仅保存在本地
- 本系统仅供参考，具体请咨询医生
- 如有紧急情况，请立即就医

## 示例用法

```
# 添加CT检查记录
/radiation add CT 胸部
/radiation add CT 腹部 2025-12-30

# 添加X光检查记录
/radiation add X光 胸部

# 查看累积状态
/radiation status

# 查看历史记录
/radiation history

# 清空所有记录
/radiation clear
```

## 错误处理

- **未设置基础参数**: "请先设置基础参数：/profile set 175 70 1990-01-01"
- **未知的检查类型**: "未知的检查类型，支持的类型：CT、X光、PET-CT等"
- **日期格式错误**: "日期格式错误，请使用 YYYY-MM-DD 格式"
- **无记录**: "暂无辐射暴露记录"
