---
description: 记录和追踪饮食营养摄入
arguments:
  - name: action
    description: 操作类型：add(添加记录)/history(历史记录)/status(营养统计)/summary(营养汇总)
    required: true
  - name: image
    description: 食物照片路径（本地图片路径或截图）
    required: false
  - name: meal_time
    description: 用餐时间（格式：HH:mm 或 YYYY-MM-DD HH:mm，默认当前时间）
    required: false
---

# 饮食营养记录

通过拍照或上传图片记录每日饮食，自动分析营养成分并追踪营养摄入情况。

## 操作类型

### 1. 添加饮食记录 - `add`

通过食物照片自动识别并记录营养成分。

**参数说明：**
- `image`: 食物照片路径（必填），支持拖拽图片或指定路径
- `meal_time`: 用餐时间（可选），格式：
  - `HH:mm` - 今天的具体时间（如：12:30）
  - `YYYY-MM-DD HH:mm` - 完整日期时间（如：2025-12-30 18:00）
  - 默认：当前时间

**示例：**
```
/diet add food.jpg
/diet add breakfast.png 08:00
/diet add lunch.jpg 2025-12-30 12:30
```

**使用流程：**
1. 用户拍摄或选择食物照片
2. AI 识别食物种类和份量
3. 自动分析营养成分
4. 保存记录并显示确认信息

### 2. 查看历史记录 - `history`

查看所有饮食记录。

**示例：**
```
/diet history
/diet history today
/diet history 2025-12-30
```

### 3. 营养统计 - `status`

查看营养摄入统计和分析。

**示例：**
```
/diet status
/diet status today
/diet status week
```

### 4. 营养汇总 - `summary`

查看特定时间段的营养汇总。

**示例：**
```
/diet summary today
/diet summary week
/diet summary month
```

## 执行步骤

### 添加记录 (add)

#### 1. 读取和分析图片

**支持的图片格式：**
- JPG/JPEG
- PNG
- WebP

**图片分析内容：**
- 食物种类识别（主食、蔬菜、肉类、水果等）
- 食物份量估算（通过视觉参考）
- 烹饪方式判断（煎、炒、蒸、煮等）
- 餐具识别（盘子大小、碗等参考）

#### 2. 营养成分分析

**必记录的营养成分：**
- **热量** (kcal)
- **蛋白质** (g)
- **脂肪** (g)
- **碳水化合物** (g)

**微量营养素：**
- **维生素A** (μg)
- **维生素B1** (mg)
- **维生素B2** (mg)
- **维生素B3** (mg)
- **维生素B6** (mg)
- **维生素B12** (μg)
- **维生素C** (mg)
- **维生素D** (μg)
- **维生素E** (mg)
- **维生素K** (μg)
- **叶酸** (μg)

**矿物质：**
- **钙** (mg)
- **铁** (mg)
- **锌** (mg)
- **钾** (mg)
- **钠** (mg)
- **镁** (mg)
- **磷** (mg)

**其他：**
- **膳食纤维** (g)
- **胆固醇** (mg)
- **水分** (g)

#### 3. 餐次分类

根据用餐时间自动分类：
- **早餐**: 05:00 - 09:59
- **午餐**: 10:00 - 14:59
- **下午茶**: 15:00 - 16:59
- **晚餐**: 17:00 - 21:59
- **夜宵**: 22:00 - 04:59

#### 4. 保存记录

**文件路径格式：**
`data/diet-records/YYYY-MM/YYYY-MM-DD_HHMM.json`

**JSON 数据结构：**
```json
{
  "id": "20251231123456789",
  "record_date": "2025-12-31",
  "meal_time": "12:30",
  "meal_type": "午餐",
  "image_path": "food.jpg",

  "foods": [
    {
      "name": "米饭",
      "portion": "1碗（约150g）",
      "weight_estimate": 150,
      "cooking_method": "蒸",
      "confidence": 0.95
    },
    {
      "name": "清炒时蔬",
      "portion": "1份（约200g）",
      "weight_estimate": 200,
      "cooking_method": "炒",
      "confidence": 0.88
    }
  ],

  "nutrition": {
    "calories": {
      "value": 485,
      "unit": "kcal",
      "breakdown": {
        "carbohydrate": 60,
        "protein": 15,
        "fat": 18,
        "fiber": 6
      }
    },
    "macronutrients": {
      "protein": { "value": 15.2, "unit": "g" },
      "fat": { "value": 18.5, "unit": "g" },
      "carbohydrate": { "value": 60.3, "unit": "g" },
      "fiber": { "value": 6.2, "unit": "g" }
    },
    "vitamins": {
      "vitamin_a": { "value": 245, "unit": "μg" },
      "vitamin_b1": { "value": 0.18, "unit": "mg" },
      "vitamin_b2": { "value": 0.12, "unit": "mg" },
      "vitamin_b3": { "value": 2.5, "unit": "mg" },
      "vitamin_b6": { "value": 0.25, "unit": "mg" },
      "vitamin_b12": { "value": 0.5, "unit": "μg" },
      "vitamin_c": { "value": 35, "unit": "mg" },
      "vitamin_d": { "value": 0.5, "unit": "μg" },
      "vitamin_e": { "value": 2.1, "unit": "mg" },
      "vitamin_k": { "value": 45, "unit": "μg" },
      "folate": { "value": 28, "unit": "μg" }
    },
    "minerals": {
      "calcium": { "value": 45, "unit": "mg" },
      "iron": { "value": 2.8, "unit": "mg" },
      "zinc": { "value": 1.5, "unit": "mg" },
      "potassium": { "value": 320, "unit": "mg" },
      "sodium": { "value": 450, "unit": "mg" },
      "magnesium": { "value": 38, "unit": "mg" },
      "phosphorus": { "value": 120, "unit": "mg" }
    },
    "other": {
      "cholesterol": { "value": 35, "unit": "mg" },
      "water": { "value": 285, "unit": "g" }
    }
  },

  "health_score": {
    "overall": 7.5,
    "balance": 8.0,
    "variety": 7.0,
    "nutrition_density": 7.5
  },

  "suggestions": [
    "蔬菜摄入量良好，建议继续保持",
    "蛋白质摄入适中，可适当增加优质蛋白比例",
    "注意控制钠盐摄入"
  ],

  "metadata": {
    "created_at": "2025-12-31T12:34:56.789Z",
    "last_updated": "2025-12-31T12:34:56.789Z",
    "ai_confidence": 0.88
  }
}
```

#### 5. 输出确认

```
✅ 饮食记录已添加

餐次信息：
━━━━━━━━━━━━━━━━━━━━━━━━━━
餐次：午餐
时间：2025-12-31 12:30
识别的食物：米饭、清炒时蔬

营养成分：
━━━━━━━━━━━━━━━━━━━━━━━━━━
热量：485 kcal
蛋白质：15.2 g  (12.5%)
脂肪：18.5 g    (15.2%)
碳水化合物：60.3 g (49.7%)
膳食纤维：6.2 g

维生素：
━━━━━━━━━━━━━━━━━━━━━━━━━━
维生素A：245 μg  (24.5%*)
维生素C：35 mg   (58.3%*)
维生素D：0.5 μg  (2.5%*)
*占每日推荐摄入量百分比

矿物质：
━━━━━━━━━━━━━━━━━━━━━━━━━━
钙：45 mg    (4.5%*)
铁：2.8 mg   (18.7%*)
钾：320 mg   (9.1%*)
钠：450 mg   (22.5%*)
*占每日推荐摄入量百分比

健康评分：7.5/10
━━━━━━━━━━━━━━━━━━━━━━━━━━
均衡度：8.0/10
多样性：7.0/10
营养密度：7.5/10

💡 建议：
• 蔬菜摄入量良好，建议继续保持
• 蛋白质摄入适中，可适当增加优质蛋白比例
• 注意控制钠盐摄入

数据已保存至：data/diet-records/2025-12/2025-12-31_1230.json
```

### 查看历史记录 (history)

**输出格式：**
```
📋 今日饮食记录

2025年12月31日
━━━━━━━━━━━━━━━━━━━━━━━━━━

🌅 早餐 (08:30)
━━━━━━━━━━━━━━━━━━━━━━━━━━
食物：牛奶、全麦面包、鸡蛋
热量：420 kcal | 蛋白质：18g | 脂肪：15g

🌞 午餐 (12:30)
━━━━━━━━━━━━━━━━━━━━━━━━━━
食物：米饭、清炒时蔬、红烧肉
热量：785 kcal | 蛋白质：22g | 脂肪：35g

🌙 晚餐 (18:45)
━━━━━━━━━━━━━━━━━━━━━━━━━━
食物：杂粮饭、清蒸鱼、蒜蓉西兰花
热量：520 kcal | 蛋白质：28g | 脂肪：12g

今日汇总：
━━━━━━━━━━━━━━━━━━━━━━━━━━
总热量：1725 kcal
蛋白质：68g (15.8%)
脂肪：62g (32.3%)
碳水化合物：195g (45.2%)
膳食纤维：18g

已记录：3餐
```

### 营养统计 (status)

**输出格式：**
```
📊 营养摄入统计

统计周期：今日
━━━━━━━━━━━━━━━━━━━━━━━━━━

热量分析：
━━━━━━━━━━━━━━━━━━━━━━━━━━
今日摄入：1725 kcal
基础代谢：1450 kcal
建议摄入：2000 kcal
完成度：86.3% ✅

宏量营养素：
━━━━━━━━━━━━━━━━━━━━━━━━━━
蛋白质：68g / 60g  (113.3%) ✅
  脂肪：62g / 65g  (95.4%) ✅
碳水化合物：195g / 250g (78%) ⚠️
  膳食纤维：18g / 25g (72%) ⚠️

微量营养素：
━━━━━━━━━━━━━━━━━━━━━━━━━━
维生素A：450 μg / 800 μg  (56.3%) ⚠️
维生素C：85 mg / 100 mg    (85%) ✅
维生素D：5 μg / 10 μg      (50%) ⚠️
钙：680 mg / 800 mg        (85%) ✅
铁：15 mg / 12 mg          (125%) ✅
锌：8 mg / 10 mg           (80%) ⚠️

健康评估：
━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 蛋白质摄入充足
✅ 钙铁摄入达标
⚠️ 维生素A摄入偏低
⚠️ 膳食纤维不足
💡 建晚餐增加深色蔬菜和水果

本周趋势：
━━━━━━━━━━━━━━━━━━━━━━━━━━
平均热量：1850 kcal/天
蛋白质达标率：92%
蔬菜水果摄入：偏低
```

### 营养汇总 (summary)

**今日汇总输出格式：**
```
📈 今日营养汇总报告

报告日期：2025年12月31日
━━━━━━━━━━━━━━━━━━━━━━━━━━

餐次分布：
━━━━━━━━━━━━━━━━━━━━━━━━━━
早餐：420 kcal (24.4%)
午餐：785 kcal (45.5%)
晚餐：520 kcal (30.1%)

营养达标情况：
━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 热量：86%
✅ 蛋白质：113%
✅ 脂肪：95%
⚠️ 碳水化合物：78%
⚠️ 膳食纤维：72%

营养缺口：
━━━━━━━━━━━━━━━━━━━━━━━━━━
需要增加：
• 深色蔬菜（胡萝卜、菠菜）- 补充维生素A
• 全谷物（燕麦、糙米）- 增加膳食纤维
• 坚果（核桃、杏仁）- 补充维生素E和锌

需要控制：
• 今日营养均衡，无需特别控制
```

## 食物识别和营养估算

### 食物识别规则

**常见主食份量参考：**
- 米饭1碗 ≈ 150g (180 kcal)
- 面条1碗 ≈ 200g (220 kcal)
- 馒头1个 ≈ 100g (220 kcal)
- 面包1片 ≈ 30g (80 kcal)

**肉类份量参考：**
- 猪肉100g ≈ 250 kcal
- 鸡肉100g ≈ 130 kcal
- 鱼肉100g ≈ 100 kcal
- 牛肉100g ≈ 200 kcal

**蔬菜份量参考：**
- 叶菜1份 ≈ 200g (40 kcal)
- 根茎类1份 ≈ 200g (80 kcal)
- 瓜果类1份 ≈ 200g (50 kcal)

### 营养评估标准

**健康评分算法：**
```javascript
health_score = {
  balance: 评估三大营养素比例（蛋白质10-20%，脂肪20-30%，碳水50-65%）
  variety: 食物种类多样性（主食、蔬菜、肉类、豆制品等）
  nutrition_density: 单位热量的营养密度
  overall: (balance + variety + nutrition_density) / 3
}
```

**营养均衡标准：**
- ✅ **优秀**: 80-100% 推荐摄入量
- ⚠️ **偏低**: 50-79% 推荐摄入量
- 🚨 **不足**: < 50% 推荐摄入量
- ⚠️ **超标**: > 120% 推荐摄入量

## 成年人每日营养推荐摄入量

### 宏量营养素
- 热量：1800-2400 kcal（根据性别、年龄、体重、活动量调整）
- 蛋白质：55-75 g (10-15% 总热量)
- 脂肪：55-75 g (20-30% 总热量)
- 碳水化合物：250-350 g (50-65% 总热量)
- 膳食纤维：25-35 g

### 主要维生素
- 维生素A：700-900 μg
- 维生素B1：1.2-1.5 mg
- 维生素B2：1.2-1.5 mg
- 维生素B3：15-20 mg
- 维生素B6：1.3-1.7 mg
- 维生素B12：2.4 μg
- 维生素C：100 mg
- 维生素D：10-20 μg
- 维生素E：14-15 mg
- 维生素K：90-120 μg
- 叶酸：400 μg

### 主要矿物质
- 钙：800-1000 mg
- 铁：12-18 mg
- 锌：10-15 mg
- 钾：2500-3500 mg
- 钠：< 2000 mg
- 镁：310-420 mg
- 磷：700 mg

## 数据结构更新

在全局索引 `data/index.json` 中添加：

```json
{
  "diet_records": [
    {
      "id": "20251231123456789",
      "date": "2025-12-31",
      "meal_time": "12:30",
      "meal_type": "午餐",
      "calories": 485,
      "protein": 15.2,
      "file_path": "diet-records/2025-12/2025-12-31_1230.json"
    }
  ]
}
```

## 注意事项

- 图片清晰度影响识别准确性，建议拍摄清晰、光线良好的照片
- 营养成分为估算值，实际值可能因食材品种和烹饪方式有所不同
- 本系统仅供营养参考，不能替代专业营养师建议
- 特殊人群（孕妇、儿童、慢性病患者）建议咨询专业营养师
- 所有数据仅保存在本地

## 示例用法

```
# 快速记录（使用当前时间）
/diet add lunch.jpg

# 记录早餐
/diet add breakfast.jpg 08:00

# 记录昨天的晚餐
/diet add dinner.jpg 2025-12-30 18:30

# 查看今日历史
/diet history today

# 查看营养统计
/diet status

# 查看本周汇总
/diet summary week
```

## 错误处理

- **图片路径无效**: "无法读取图片，请检查路径是否正确"
- **图片格式不支持**: "不支持的图片格式，请使用 JPG、PNG 或 WebP"
- **图片无法识别**: "无法清晰识别食物，请提供更清晰的照片"
- **日期格式错误**: "时间格式错误，请使用 HH:mm 或 YYYY-MM-DD HH:mm 格式"
- **无记录**: "暂无饮食记录"
- **存储失败**: "保存记录失败，请检查存储空间"
