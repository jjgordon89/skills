---
description: AI驱动的健康分析系统，包括综合分析、风险预测、智能问答和报告生成
arguments:
  - name: action
    description: AI操作类型：analyze/predict/chat/report/status
    required: true
  - name: target
    description: 分析目标：风险类型、报告类型、查询内容等
    required: false
  - name: options
    description: 附加选项：时间范围、输出格式等
    required: false
---

# AI健康助手

AI驱动的综合健康分析系统，提供智能健康洞察、风险预测和个性化建议。

## 命令格式

```bash
/ai <action> [target] [options]
```

## 可用操作

### 1. `/ai analyze` - AI综合健康分析

整合所有健康数据源，执行多维度分析，识别关键模式和趋势。

**用法**:
```bash
/ai analyze [time_range]
```

**参数**:
- `time_range`: 时间范围（可选）
  - `all` - 所有数据（默认）
  - `last_month` - 上个月
  - `last_quarter` - 上季度（3个月，默认）
  - `last_year` - 去年
  - `YYYY-MM-DD` - 从指定日期至今
  - `YYYY-MM-DD,YYYY-MM-DD` - 自定义范围

**示例**:
```bash
/ai analyze                    # 分析过去3个月数据
/ai analyze last_month         # 分析上个月数据
/ai analyze 2025-01-01         # 分析从2025年1月1日至今
/ai analyze all                # 分析所有历史数据
```

**执行步骤**:
1. 读取AI配置和用户档案
2. 读取所有健康数据源（基础指标、生活方式、心理健康、医疗历史）
3. 执行多维度分析：
   - 相关性分析（皮尔逊、斯皮尔曼）
   - 趋势分析（线性回归、移动平均）
   - 异常检测（CUSUM、Z-score）
4. 生成个性化建议（Level 1-3）
5. 输出文本报告
6. 生成HTML报告（可选）

**输出格式**:
```
AI健康分析报告
═══════════════════════════════════
生成时间: 2025-01-08
分析周期: 过去90天

📊 总体评估
━━━━━━━━━━━━━━━━━━━━━━━━━━
健康指数: 72/100（良好）
改善中: 睡眠质量、运动水平
需关注: BMI、用药依从性

🎯 风险预测
━━━━━━━━━━━━━━━━━━━━━━━━━━
🔴 高血压风险: 32% (中等风险)
🟡 糖尿病风险: 18% (低风险)
🟢 心血管风险: 8% (低风险)

📈 关键趋势
━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 体重: 70kg → 68kg (-2kg, 改善中)
⚠️ BMI: 24.5 → 24.9 (轻微上升)
✅ 睡眠时长: 6.2h → 7.1h (显著改善)

🔗 关键发现
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 睡眠时长与情绪评分强相关 (r=0.78)
• 运动量增加与体重改善正相关 (r=0.65)
• 用药依从性与症状频率负相关 (r=-0.62)

💡 个性化建议
━━━━━━━━━━━━━━━━━━━━━━━━━━
[Level 1] 保持良好的睡眠习惯
[Level 2] 提高用药依从性
[Level 3] ⚠️ 体重管理需关注

═══════════════════════════════════
⚠️ 重要声明
本AI分析仅供参考，不构成医疗诊断。
请咨询医生获取专业医疗建议。
```

---

### 2. `/ai predict` - 健康风险预测

基于历史数据和循证医学模型，预测特定健康风险。

**用法**:
```bash
/ai predict <risk_type>
```

**支持的风险类型**:
- `hypertension` - 高血压风险（10年）
- `diabetes` - 糖尿病风险（10年）
- `cardiovascular` - 心血管疾病风险（10年）
- `nutritional_deficiency` - 营养缺乏风险
- `sleep_disorder` - 睡眠障碍风险
- `all` - 所有风险预测

**示例**:
```bash
/ai predict hypertension           # 预测高血压风险
/ai predict diabetes               # 预测糖尿病风险
/ai predict cardiovascular         # 预测心血管风险
/ai predict all                    # 预测所有风险
```

**执行步骤**:
1. 读取用户档案和相关健康数据
2. 提取风险因子（年龄、BMI、血压、血糖、家族史等）
3. 应用风险预测模型：
   - Framingham风险评分（高血压、心血管）
   - ADA风险评分（糖尿病）
4. 计算风险概率和等级
5. 识别可修改风险因素
6. 生成预防建议

**输出格式**:
```
🎯 高血压风险预测报告
═══════════════════════════════════
预测模型: Framingham风险评分（简化版）
时间范围: 未来10年
生成时间: 2025-01-08

📊 风险评估
━━━━━━━━━━━━━━━━━━━━━━━━━━
风险概率: 32%
风险等级: 🟡 中等风险
置信度: 中等

⚠️ 主要风险因素
━━━━━━━━━━━━━━━━━━━━━━━━━━
1. BMI: 24.9 (接近超重)
2. 收缩压: 128 mmHg (正常高值)
3. 家族史: 有高血压家族史
4. 年龄: 45-54岁 (中等风险年龄段)

✅ 可修改因素
━━━━━━━━━━━━━━━━━━━━━━━━━━
1. BMI (当前24.9，目标<24)
2. 体力活动 (当前中等，建议增加到高等)
3. 饮食习惯 (建议DASH饮食)

💡 预防建议
━━━━━━━━━━━━━━━━━━━━━━━━━━

[Level 1] 生活方式干预
• 控制体重，使BMI保持在18.5-24.9
• 每周至少150分钟中等强度有氧运动
• 采用DASH饮食模式（低钠、高钾、高镁）
• 限制饮酒量（男性<2杯/天，女性<1杯/天）

[Level 2] 基于个人数据的建议
• 当前血压128/82 mmHg，建议每月监测
• BMI接近超重界限，建议控制在24以下
• 家族史阳性，建议每年体检关注血压

[Level 3] ⚠️ 医疗建议
• 风险概率32%，建议咨询医生
• 讨论是否需要开始预防性治疗
• 建立定期血压监测计划

📅 建议复查
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 3个月后复查血压
• 6个月后重新评估风险
• 每年进行全面体检

═══════════════════════════════════
⚠️ 免责声明
本预测基于统计学模型和群体数据，
不能确定个体结果。仅供参考，
请咨询医生获取专业评估。
```

---

### 3. `/ai chat` - 智能健康问答

自然语言健康问答系统，支持健康数据查询、趋势分析、相关性查询等。

**用法**:
```bash
/ai chat <query>
```

**支持的查询类型**:

**数据查询**:
```bash
/ai chat 我的平均睡眠时间是多少？
/ai chat 我最近的体重是多少？
/ai chat 我本周运动了多少次？
```

**趋势分析**:
```bash
/ai chat 我的体重最近有什么变化？
/ai chat 我的睡眠质量有改善吗？
/ai chat 我的血压趋势怎么样？
```

**相关性查询**:
```bash
/ai chat 运动对我的睡眠有什么影响？
/ai chat 饮食和我的体重有关系吗？
/ai chat 用药依从性影响症状吗？
```

**建议咨询**:
```bash
/ai chat 我如何改善睡眠质量？
/ai chat 我应该如何降低高血压风险？
/ai chat 我应该增加哪些营养素摄入？
```

**风险评估**:
```bash
/ai chat 我有糖尿病的风险吗？
/ai chat 我的健康风险有哪些？
/ai chat AI分析我的健康状况
```

**执行步骤**:
1. 解析用户查询，识别意图和实体
2. 检索相关健康数据
3. 执行相应分析（统计、趋势、相关性等）
4. 生成自然语言回复
5. 提供相关建议和后续操作

**输出格式**: 自然语言对话，包含：
- 直接回答用户问题
- 支持性数据和分析
- 相关建议
- 后续操作建议

---

### 4. `/ai report` - 生成AI健康报告

生成包含AI洞察的HTML交互式健康报告。

**用法**:
```bash
/ai report generate <report_type> [time_range] [output_file]
```

**报告类型**:
- `comprehensive` - 综合健康报告（默认）
- `quick_summary` - 快速摘要
- `risk_assessment` - 风险评估报告
- `trend_analysis` - 趋势分析报告

**示例**:
```bash
/ai report generate                          # 生成综合报告
/ai report generate comprehensive            # 生成综合报告
/ai report generate quick_summary            # 生成快速摘要
/ai report generate risk_assessment          # 生成风险评估报告
/ai report generate trend_analysis last_year # 生成趋势分析报告（过去1年）
```

**执行步骤**:
1. 读取用户数据和AI配置
2. 根据报告类型执行相应分析
3. 调用 `scripts/generate_ai_report.py` 生成HTML报告
4. 保存到 `data/ai-reports/` 目录
5. 显示报告文件路径和预览链接

**输出格式**:
```
📄 AI健康报告生成中...
━━━━━━━━━━━━━━━━━━━━━━━━━━
报告类型: 综合健康报告
时间范围: 过去90天
数据源: 4类数据源已整合

✅ 报告生成成功
━━━━━━━━━━━━━━━━━━━━━━━━━━
文件路径: data/ai-reports/ai-health-report-20250108.html
报告大小: 245 KB

📊 报告内容
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 总体健康评估
• 多维度趋势分析（6个交互式图表）
• 健康风险预测（4类疾病）
• 关键相关性发现
• 个性化建议（3级分类）

💡 提示
━━━━━━━━━━━━━━━━━━━━━━━━━━
在浏览器中打开HTML文件查看交互式图表
可以分享给医生或健康顾问

打开方式:
• Mac: open data/ai-reports/ai-health-report-20250108.html
• Windows: start data/ai-reports/ai-health-report-20250108.html
• Linux: xdg-open data/ai-reports/ai-health-report-20250108.html
```

---

### 5. `/ai status` - 查看AI功能状态

查看AI配置、功能开关和历史记录。

**用法**:
```bash
/ai status
```

**示例**:
```bash
/ai status
```

**输出格式**:
```
🤖 AI健康助手状态
═══════════════════════════════════
版本: 1.0.0
最后更新: 2025-01-08

✅ 功能状态
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 智能分析: ✅ 已启用
• 风险预测: ✅ 已启用
• 自然语言交互: ✅ 已启用
• 报告生成: ✅ 已启用

📊 数据源
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 基础健康指标: ✅ 已配置
• 生活方式数据: ✅ 已配置
• 心理健康数据: ✅ 已配置
• 医疗历史数据: ✅ 已配置

📈 使用统计
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 总分析次数: 0
• 总预测次数: 0
• 总报告数: 0
• 对话会话数: 0

⚙️ 配置信息
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 个性化级别: 基础
• 数据存储: 本地
• 隐私模式: 已启用
• 分析时间范围: 默认90天

📝 最近活动
━━━━━━━━━━━━━━━━━━━━━━━━━━
暂无活动记录
```

---

## 配置选项

AI功能配置位于 `data/ai-config.json`：

```json
{
  "ai_features": {
    "enabled": true,
    "analysis": {
      "enabled": true,
      "default_time_range_days": 90
    },
    "predictions": {
      "enabled": true,
      "supported_risks": [...]
    },
    "report_generation": {
      "enabled": true,
      "default_output_dir": "data/ai-reports"
    }
  }
}
```

## 安全与隐私

- ✅ 所有数据仅保存在本地
- ✅ 不上传到云端服务
- ✅ 不与第三方共享数据
- ⚠️ AI分析仅供参考，不构成医疗诊断
- ⚠️ 风险预测基于统计学，不能确定个体结果
- ⚠️ 个性化建议不能替代医生建议

## 相关命令

- `/profile` - 管理用户基础档案
- `/query` - 查询医疗记录
- `/specialist` - 咨询专科专家
- `/consult` - 多学科专家会诊
- `/nutrition` - 营养分析
- `/sleep` - 睡眠分析
- `/fitness` - 运动分析
