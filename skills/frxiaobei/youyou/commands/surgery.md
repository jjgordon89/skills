---
description: 记录个人手术历史
arguments:
  - name: description
    description: 手术描述（一句话描述，包含手术名称、时间、原因等信息）
    required: true
---

# 个人手术历史记录

用于记录个人的手术历史，从自然语言描述中提取结构化手术信息。

## 参数说明

- `description`（必填）：一句话描述手术信息，可以包含：
  - 手术名称（医学术语或通俗名称）
  - 手术日期
  - 手术原因/诊断
  - 手术部位
  - 其他相关信息

## 执行步骤

### 1. 解析用户输入

从用户的自然语言描述中提取以下信息：

**必需字段：**
- **手术全称（医学术语）**：如"腹腔镜下胆囊切除术"
- **手术别称（通俗描述）**：如"胆囊微创手术"
- **手术原因/术前诊断**：如"慢性结石性胆囊炎"
- **手术日期（年月日）**：如"2024-08-15"
- **手术身体部位**：如"腹部"

**可选字段（从描述中提取或询问）：**
- 手术类型： elective（择期手术）/ emergency（急诊手术）/ day_surgery（日间手术）
- 麻醉方式：全身麻醉/局部麻醉/椎管内麻醉/神经阻滞麻醉
- 手术时长：分钟数
- 术中出血量：毫升数
- 主刀医生：医生姓名
- 手术医院：医院名称
- 住院天数：天数

### 2. 询问植入物信息

**必须询问用户：**
```
📋 植入物信息确认

本次手术中是否有植入以下任何医疗材料？
- 人工关节/植入物
- 支架/导管
- 金属内固定物（钢板、螺钉、钢针等）
- 人工瓣膜/起搏器
- 疝修补片/补片
- 其他植入物

A. 有植入物
B. 无植入物
```

如果选择"有植入物"，则询问详细信息：
```
请提供植入物信息：
1. 植入物名称：如"钛钢板"、"冠状动脉支架"
2. 植入物型号/规格：如"××品牌×型号"
3. 植入部位：具体位置
4. 植入物数量：数量
5. 预计取出时间：如有（如"3个月后取出"、"终身保留"）
```

### 3. 生成数据文件

**文件路径格式：**
`data/手术记录/YYYY-MM/YYYY-MM-DD_手术名称.json`

**JSON 数据结构：**
```json
{
  "id": "{{生成唯一ID，使用日期+时间戳}}",
  "basic_info": {
    "surgery_name": "腹腔镜下胆囊切除术",
    "surgery_alias": "胆囊微创手术",
    "surgery_date": "2024-08-15",
    "preoperative_diagnosis": "慢性结石性胆囊炎",
    "body_part": "腹部",
    "surgery_type": "elective",
    "anesthesia_type": "全身麻醉",
    "duration_minutes": 90,
    "blood_loss_ml": 50,
    "surgeon": "张医生",
    "hospital": "某某医院",
    "hospitalization_days": 3
  },
  "implants": {
    "has_implants": false,
    "implants_list": []
  },
  "postoperative_info": {
    "complications": null,
    "recovery_status": "良好",
    "follow_up_plan": null
  },
  "notes": "用户补充说明或其他重要信息",
  "created_at": "2024-08-15",
  "original_input": "用户原始输入描述"
}
```

**如果包含植入物，implants 结构示例：**
```json
{
  "has_implants": true,
  "implants_list": [
    {
      "implant_name": "钛合金钢板",
      "model": "××品牌×型号",
      "location": "右胫骨中段",
      "quantity": 1,
      "removal_plan": "12个月后取出",
      "implant_date": "2024-08-15"
    }
  ]
}
```

### 4. 保存数据

- 创建月份目录（如不存在）
- 保存 JSON 数据文件
- 更新全局索引 `data/index.json`

### 5. 更新索引

在 `data/index.json` 中添加新记录：
```json
{
  "records": [
    {
      "id": "记录ID",
      "type": "手术记录",
      "date": "YYYY-MM-DD",
      "file_path": "手术记录/YYYY-MM/YYYY-MM-DD_手术名称.json"
    }
  ]
}
```

### 6. 报告结果

```
✅ 手术记录已保存

基本信息：
━━━━━━━━━━━━━━━━━━━━━━━━━━
手术名称：腹腔镜下胆囊切除术（胆囊微创手术）
手术日期：2024-08-15
术前诊断：慢性结石性胆囊炎
手术部位：腹部
手术类型：择期手术
麻醉方式：全身麻醉
手术时长：90分钟
术中出血：50ml

植入物信息：
━━━━━━━━━━━━━━━━━━━━━━━━━━
无植入物

数据已保存至：
data/手术记录/2024-08/2024-08-15_腹腔镜下胆囊切除术.json
```

## 手术类型分类

- **elective（择期手术）**：可以提前安排的手术，非紧急情况
- **emergency（急诊手术）**：需要立即进行的紧急手术
- **day_surgery（日间手术）**：当天住院、当天出院的手术
- **diagnostic（诊断性手术）**：主要用于明确诊断的手术
- **therapeutic（治疗性手术）**：主要用于治疗的手术
- **palliative（姑息手术）**：减轻症状但不能治愈的手术
- **reconstructive（重建手术）**：重建或修复功能的手术

## 麻醉方式分类

- **全身麻醉**：使用静脉或吸入麻醉药物
- **局部麻醉**：局部区域麻醉
- **椎管内麻醉**：包括腰麻、硬膜外麻醉
- **神经阻滞麻醉**：特定神经阻滞
- **监测下麻醉护理（MAC）**：轻度镇静

## 智能提取规则

### 日期提取

优先级：
1. 明确的日期格式：2024-08-15、2024年8月15日、去年8月
2. 相对时间：3个月前、去年、今年6月
3. 如果无法提取，询问用户

### 手术名称识别

- 医学术语：如"腹腔镜下阑尾切除术"
- 通俗名称：如"割阑尾"、"割胆囊"
- 自动匹配：建立常见手术名称映射表

### 身体部位识别

常见部位映射：
- 腹部手术：腹部、肚子、胃部、肝胆等
- 骨科手术：四肢、关节、脊柱等
- 胸部手术：胸部、心脏、肺部等
- 神经外科：头部、脑部等
- 五官科：耳鼻喉、眼部等

## 常见手术示例

```
# 示例1：胆囊手术
/surgery 去年8月15日做了腹腔镜下胆囊切除术，因为慢性结石性胆囊炎

# 示例2：骨折手术
/surgery 2024年3月10日右腿胫骨骨折内固定术，车祸

# 示例3：眼科手术
/surgery 今年6月做了近视激光手术

# 示例4：牙科手术
/surgery 上个月拔了智齿

# 示例5：心脏手术
/surgery 2023年12月做了冠状动脉支架植入术，心绞痛

# 示例6：妇科手术
/surgery 2022年5月做了子宫肌瘤剔除术
```

## 扩展字段

如果用户提供更多信息，自动提取并记录：

- **术前检查**：重要的术前检查结果
- **术中情况**：特殊发现或并发症
- **术后恢复**：恢复情况描述
- **病理结果**：如果做了病理检查
- **随访计划**：后续复查安排
- **备注信息**：任何其他重要信息

## 注意事项

- 如果关键信息缺失，主动询问用户
- 日期格式统一转换为 YYYY-MM-DD
- 尽可能完整记录手术信息
- 植入物信息特别重要，必须确认
- 保持数据结构化，便于后续查询和分析
- 所有数据仅保存在本地

## 数据查询

手术记录可以通过 `/query surgery` 命令查询：
- 查询所有手术记录
- 按时间范围查询
- 按手术部位查询
- 按手术名称查询
